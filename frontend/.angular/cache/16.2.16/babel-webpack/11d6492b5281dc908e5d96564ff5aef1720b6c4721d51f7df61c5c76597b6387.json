{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/gadhg/Desktop/backup/iso9001-microservices/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Keycloak from 'keycloak-js';\nimport * as i0 from \"@angular/core\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor() {\n      this.kc = null;\n      this.authenticated = false;\n    }\n    init() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.kc = new Keycloak({\n          url: 'http://localhost:8085',\n          realm: 'iso9001-realm',\n          clientId: 'frontend'\n        });\n        const kc = _this.kc;\n        if (!kc) {\n          throw new Error('Keycloak instance not initialized');\n        }\n        const authenticated = yield kc.init({\n          onLoad: 'login-required',\n          checkLoginIframe: false,\n          pkceMethod: 'S256',\n          silentCheckSsoRedirectUri: window.location.origin + '/silent-check-sso.html'\n        });\n        _this.authenticated = authenticated;\n        if (authenticated) {\n          _this.token = kc.token;\n          const profile = yield kc.loadUserProfile();\n          _this.username = profile.username || profile.email || profile.firstName;\n          _this.refreshTokenScheduler();\n        }\n      })();\n    }\n    refreshTokenScheduler() {\n      var _this2 = this;\n      if (!this.kc) return;\n      setInterval( /*#__PURE__*/_asyncToGenerator(function* () {\n        if (!_this2.kc) return;\n        const refreshed = yield _this2.kc.updateToken(30).catch(() => false);\n        if (refreshed) {\n          _this2.token = yield _this2.kc.token;\n        }\n      }), 20000);\n    }\n    login() {\n      this.kc?.login();\n    }\n    logout() {\n      this.kc?.logout({\n        redirectUri: window.location.origin\n      });\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(t) {\n        return new (t || AuthService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}