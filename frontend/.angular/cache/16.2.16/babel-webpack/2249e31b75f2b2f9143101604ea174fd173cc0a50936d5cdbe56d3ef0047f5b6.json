{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/gadhg/Desktop/backup/iso9001-microservices/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport Keycloak from 'keycloak-js';\nimport * as i0 from \"@angular/core\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor() {\n      this.authenticated = false;\n    }\n    init() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        // Configure Keycloak (matches frontend/src/assets/keycloak.json)\n        _this.kc = new Keycloak({\n          url: 'http://localhost:8085',\n          realm: 'iso9001-realm',\n          clientId: 'frontend'\n        });\n        try {\n          const authenticated = yield _this.kc.init({\n            onLoad: 'check-sso',\n            silentCheckSsoRedirectUri: `${window.location.origin}/assets/silent-check-sso.html`,\n            checkLoginIframe: false,\n            pkceMethod: 'S256'\n          });\n          _this.authenticated = authenticated;\n          if (authenticated) {\n            _this.token = _this.kc?.token || undefined;\n            _this.username = _this.kc?.tokenParsed?.preferred_username || undefined;\n            // Clean up URL hash with repeated Keycloak params\n            window.history.replaceState({}, document.title, window.location.origin);\n            // Periodically refresh token\n            if (_this.kc) {\n              _this.kc.onTokenExpired = /*#__PURE__*/_asyncToGenerator(function* () {\n                try {\n                  yield _this.kc?.updateToken(30);\n                  _this.token = _this.kc?.token || undefined;\n                } catch {\n                  // If refresh fails, force re-login\n                  yield _this.login();\n                }\n              });\n            }\n          }\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.error('Keycloak init failed', e);\n          _this.authenticated = false;\n        }\n      })();\n    }\n    login() {\n      if (!this.kc) {\n        return Promise.resolve();\n      }\n      return this.kc.login();\n    }\n    logout() {\n      if (!this.kc) {\n        return Promise.resolve();\n      }\n      return this.kc.logout({\n        redirectUri: window.location.origin\n      });\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(t) {\n        return new (t || AuthService)();\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}